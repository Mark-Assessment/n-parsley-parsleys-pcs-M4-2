{% extends "base.html" %}
{% load static %}
{% load currency %}
{% load custom_filters %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'products/css/products.css' %}">
{% endblock %}

{% block page_header %}
<h1 class='text-center'>All Products</h1>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-1 col-lg-2">
            <form method="get" class="mb-4 filter-form">
                <div class="form-row">
                    <div class="col-md-12 mb-3 custom-input">
                        {{ form.price_min.label_tag }}
                        {{ form.price_min }}
                    </div>
                    <div class="col-md-12 mb-3 custom-input">
                        {{ form.price_max.label_tag }}
                        {{ form.price_max }}
                    </div>
                    <div class="col-md-12 mb-3 custom-input">
                        {{ form.rating_min.label_tag }}
                        {{ form.rating_min }}
                    </div>
                    <div class="col-md-12 mb-3 custom-input">
                        {{ form.rating_max.label_tag }}
                        {{ form.rating_max }}
                    </div>
                </div>
                <div class="form-row">
                    <div class="col-md-12 mb-3 custom-input">
                        {{ form.category.label_tag }}
                        {{ form.category }}
                    </div>
                    <div class="col-md-12 mb-3 custom-input">
                        {{ form.brand.label_tag }}
                        {{ form.brand }}
                    </div>
                    <div class="col-md-12 mb-3 custom-input">
                        {{ form.sort_by.label_tag }}
                        {{ form.sort_by }}
                    </div>
                </div>
                <div class='filter-button-div'>
                    <button type="submit" class="btn btn-primary">Filter</button>
                </div>
            </form>
        </div>
        <div class="col-10 col-lg-8 main-column">
            
            <div class="row">
                {% for product in products %}
                <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                    <div class="card h-100 {% if product.is_featured %}featured{% endif %}">
                        {% if product.is_featured %}
                        <div class="featured-label">Featured</div>
                        {% endif %}
                        <a href="{% url 'product_detail' product.slug %}">
                            <div class="card-img">
                                <img src="{% if product.image %}{{ product.image.url }}{% else %}{% static 'media/default-product.png' %}{% endif %}" alt="{{ product.name }}">
                            </div>
                            <div class="card-info">
                                <p class="text-title">{{ product.name }}</p>
                                <p class="text-body">{{ product.description|truncatewords:10 }}</p>
                            </div>
                        </a>
                        <div class="card-footer">
                            <div class="stars">
                                {% for i in 1|to:5 %}
                                <i class="fa fa-star {% if product.rating < i %}empty{% endif %}"></i>
                                {% endfor %}
                            </div>
                            <span class="text-title">
                                {% if product.is_discounted %}
                                <span style="color: red; text-decoration: line-through; font-size: 0.8em;">
                                    {{ product.price|convert_price:request.conversion_info }}
                                </span>
                                <br>
                                <span style="color: green;">
                                    {{ product.discount_price|convert_price:request.conversion_info }}
                                </span>
                                {% else %}
                                {{ product.price|convert_price:request.conversion_info }}
                                {% endif %}
                            </span>
                            <div class="card-button">
                                <form action="{% url 'add_to_cart' product.id %}" method="post">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fa fa-shopping-cart"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="col-1 col-lg-2"></div>
    </div>
</div>
{% endblock %}

{% block postloadjs %}
{% endblock %}